---
import { useTranslations, type Lang } from "@/i18n";
import { Code } from "astro:components";
const t = useTranslations(Astro.currentLocale as Lang);
import { Image } from "astro:assets";

const { image, alt = "", code = "" ,height="max-h-[350px]"} = Astro.props;
---

<div class="my-6 flex flex-col lg:flex-row gap-6">
    <div class="relative flex-1 group">
        <!-- Window Header -->
        <div class="flex items-center justify-between px-4 py-2 bg-[#282c34] rounded-t-xl border-b border-gray-700">
            <div class="flex gap-2">
                <div class="w-3 h-3 rounded-full bg-red-500 hover:bg-red-600 transition-colors"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500 hover:bg-yellow-600 transition-colors"></div>
                <div class="w-3 h-3 rounded-full bg-green-500 hover:bg-green-600 transition-colors"></div>
            </div>
            <div class="text-xs text-gray-400 font-mono">python</div>
        </div>

        <!-- Copy Button -->
        <button
            class="absolute top-10 right-4 z-10 bg-white/10 backdrop-blur-sm border border-white/20 text-white/80 px-3 py-1.5 rounded-lg text-xs hover:bg-white/20 transition-all opacity-0 group-hover:opacity-100 duration-200"
            data-code={code}
            onclick="
                const btn = this;
                navigator.clipboard.writeText(this.getAttribute('data-code'));
                const originalText = btn.textContent;
                btn.textContent = btn.getAttribute('data-success');
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            "
            data-success={t({ zh: "已复制!", en: "Copied!" })}
        >
            {t({ zh: "复制", en: "Copy" })}
        </button>

        <div class="rounded-b-xl overflow-hidden bg-[#282c34] shadow-2xl ring-1 ring-gray-900/5">
            <Code
                class={`${height} p-5 h-full text-sm leading-relaxed
           overflow-auto
           [&::-webkit-scrollbar]:w-2
           [&::-webkit-scrollbar]:h-2  
           [&::-webkit-scrollbar-track]:bg-transparent
           [&::-webkit-scrollbar-thumb]:bg-gray-600
           [&::-webkit-scrollbar-thumb]:rounded-full`}
                code={code}
                lang="python"
                theme="dracula"
            />
        </div>
    </div>

    {
        image && (
            <div class="flex-shrink-0 w-full lg:w-auto lg:max-w-xs self-center">
                <Image
                    src={image}
                    alt={alt}
                    width={300}
                    height={300}
                    class="w-full h-auto rounded-2xl shadow-2xl dark:brightness-[0.8] border-4 border-white dark:border-gray-700 transform hover:scale-[1.02] transition-transform duration-300"
                />
            </div>
        )
    }
</div>