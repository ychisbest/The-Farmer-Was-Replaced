---
import { SITE_TITLE } from "../consts";
import { getRelativeLocaleUrl } from "astro:i18n";
import { useTranslations, type Lang } from "@/i18n";
import { DEFAULT_LOCALE_SETTING, LOCALES_SETTING } from "@/locales";
import { Image } from "astro:assets";
import logo from "@/assets/geminiHero.png";

const t = useTranslations(Astro.currentLocale as Lang);
const locale = Astro.currentLocale || DEFAULT_LOCALE_SETTING;
const path = Astro.url.pathname.replace(/^\/[a-z]{2}(?:-[A-Z]{2})?\//, "/");
---

<header class="border-b border-neutral-200 bg-white sticky top-0 z-50 dark:bg-neutral-900 dark:border-neutral-700 transition-colors">
  <nav class="mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <div class="flex items-center gap-2">
        <Image src={logo} alt="Logo" width={50} height={50} class=" rounded-xl" />
        <a href={getRelativeLocaleUrl(locale, "/")} class="w-40 text-sm font-bold text-neutral-900 dark:text-white">
          {t({
            en: "The Farmer Was Replaced Aggregator",
            zh: "编程农场中文站",
          })}
        </a>
        <div class="hidden md:flex items-center gap-6">

        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="relative">
          <select
            class="appearance-none bg-white border border-neutral-300 text-neutral-900 text-sm rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-neutral-500 transition-colors dark:bg-neutral-800 dark:border-neutral-600 dark:text-neutral-200 dark:focus:ring-neutral-400"
            aria-label="Select language"
            onchange={`window.location.href = this.value`}
          >
            {
              Object.keys(LOCALES_SETTING).map((l) => {
                const target = getRelativeLocaleUrl(l as any, path || "/");
                return (
                  <option value={target} selected={l === locale}>
                    {LOCALES_SETTING[l as keyof typeof LOCALES_SETTING].label}
                  </option>
                );
              })
            }
          </select>
          <span class="pointer-events-none absolute inset-y-0 right-2 flex items-center text-neutral-500 dark:text-neutral-400">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </span>
        </div>

        <button
          type="button"
          class="relative p-2 text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors dark:text-neutral-100 dark:hover:bg-neutral-800"
          aria-label="Toggle dark mode"
          onclick={`
            if(document.documentElement.classList.contains('dark')){
              document.documentElement.classList.remove('dark');
              localStorage.setItem('hs_theme', 'light');
            }else{
              document.documentElement.classList.add('dark');
              localStorage.setItem('hs_theme', 'dark');
            }

            loadUtterances();
          `}
        >
          <span class="group inline-flex shrink-0 justify-center items-center size-5">
            <svg
              class="absolute size-5 transition-opacity duration-200 dark:opacity-0 opacity-100"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
            </svg>
            <svg
              class="absolute size-5 transition-opacity duration-200 opacity-0 dark:opacity-100"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="4"></circle>
              <path d="M12 2v2"></path>
              <path d="M12 20v2"></path>
              <path d="m4.93 4.93 1.41 1.41"></path>
              <path d="m17.66 17.66 1.41 1.41"></path>
              <path d="M2 12h2"></path>
              <path d="M20 12h2"></path>
              <path d="m6.34 17.66-1.41 1.41"></path>
              <path d="m19.07 4.93-1.41 1.41"></path>
            </svg>
          </span>
        </button>

      </div>
    </div>
  </nav>

