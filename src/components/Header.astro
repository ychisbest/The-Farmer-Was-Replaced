---
import { SITE_TITLE } from "../consts";
import { getRelativeLocaleUrl } from "astro:i18n";
import { useTranslations, type Lang } from "@/i18n";
import { DEFAULT_LOCALE_SETTING, LOCALES_SETTING } from "@/locales";

const t = useTranslations(Astro.currentLocale as Lang);
const locale = Astro.currentLocale || DEFAULT_LOCALE_SETTING;
const path = Astro.url.pathname.replace(/^\/[a-z]{2}(?:-[A-Z]{2})?\//, "/");
---

<header class="border-b border-neutral-200 bg-white sticky top-0 z-50 dark:bg-neutral-900 dark:border-neutral-700 transition-colors">
  <nav class="mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <div class="flex items-center gap-8">
        <a href={getRelativeLocaleUrl(locale, "/")} class="text-xl font-bold text-neutral-900 dark:text-white">
          {t({
            en: "The Farmer Was Replaced",
            zh: "编程农场",
          })}
        </a>
        <div class="hidden md:flex items-center gap-6">
          <a href={getRelativeLocaleUrl(locale, "/")} class="text-sm font-medium text-neutral-900 hover:text-neutral-600 transition-colors dark:text-white dark:hover:text-neutral-300">
            {t({ en: "Home", zh: "首页" })}
          </a>
          <a href={getRelativeLocaleUrl(locale, "/guide")} class="text-sm font-medium text-neutral-600 hover:text-neutral-900 transition-colors dark:text-neutral-300 dark:hover:text-white">
            {t({ en: "Guide", zh: "指南" })}
          </a>
          <a href={getRelativeLocaleUrl(locale, "/blog")} class="text-sm font-medium text-neutral-600 hover:text-neutral-900 transition-colors dark:text-neutral-300 dark:hover:text-white">
            {t({ en: "Codes", zh: "代码" })}
          </a>
          <a href={getRelativeLocaleUrl(locale, "/about")} class="text-sm font-medium text-neutral-600 hover:text-neutral-900 transition-colors dark:text-neutral-300 dark:hover:text-white">
            {t({ en: "About", zh: "关于" })}
          </a>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="relative">
          <select
            class="appearance-none bg-white border border-neutral-300 text-neutral-900 text-sm rounded-lg px-3 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-neutral-500 transition-colors dark:bg-neutral-800 dark:border-neutral-600 dark:text-neutral-200 dark:focus:ring-neutral-400"
            aria-label="Select language"
            onchange={`window.location.href = this.value`}
          >
            {
              Object.keys(LOCALES_SETTING).map((l) => {
                const target = getRelativeLocaleUrl(l as any, path || "/");
                return (
                  <option value={target} selected={l === locale}>
                    {LOCALES_SETTING[l as keyof typeof LOCALES_SETTING].label}
                  </option>
                );
              })
            }
          </select>
          <span class="pointer-events-none absolute inset-y-0 right-2 flex items-center text-neutral-500 dark:text-neutral-400">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </span>
        </div>

        <button
          type="button"
          class="relative p-2 text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors dark:text-neutral-100 dark:hover:bg-neutral-800"
          aria-label="Toggle dark mode"
          onclick={`
            if(document.documentElement.classList.contains('dark')){
              document.documentElement.classList.remove('dark');
              localStorage.setItem('hs_theme', 'light');
            }else{
              document.documentElement.classList.add('dark');
              localStorage.setItem('hs_theme', 'dark');
            }
          `}
        >
          <span class="group inline-flex shrink-0 justify-center items-center size-5">
            <svg
              class="absolute size-5 transition-opacity duration-200 dark:opacity-0 opacity-100"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
            </svg>
            <svg
              class="absolute size-5 transition-opacity duration-200 opacity-0 dark:opacity-100"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="4"></circle>
              <path d="M12 2v2"></path>
              <path d="M12 20v2"></path>
              <path d="m4.93 4.93 1.41 1.41"></path>
              <path d="m17.66 17.66 1.41 1.41"></path>
              <path d="M2 12h2"></path>
              <path d="M20 12h2"></path>
              <path d="m6.34 17.66-1.41 1.41"></path>
              <path d="m19.07 4.93-1.41 1.41"></path>
            </svg>
          </span>
        </button>

        <button
          type="button"
          id="mobile-menu-button"
          class="md:hidden p-2 text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors dark:text-neutral-100 dark:hover:bg-neutral-800"
          aria-label="Toggle mobile menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <div id="mobile-menu" class="hidden md:hidden pb-4">
    <div class="px-4 flex flex-col gap-3">
      <a href={getRelativeLocaleUrl(locale, "/")} class="text-sm font-medium text-neutral-900 hover:text-neutral-600 transition-colors dark:text-white dark:hover:text-neutral-300">
        {t({ en: "Home" })}
      </a>
      <a href={getRelativeLocaleUrl(locale, "/guide")} class="text-sm font-medium text-neutral-600 hover:text-neutral-900 transition-colors dark:text-neutral-300 dark:hover:text-white">
        {t({ en: "Guide" })}
      </a>
      <a href={getRelativeLocaleUrl(locale, "/blog")} class="text-sm font-medium text-neutral-600 hover:text-neutral-900 transition-colors dark:text-neutral-300 dark:hover:text-white">
        {t({ en: "Codes" })}
      </a>
      <a href={getRelativeLocaleUrl(locale, "/about")} class="text-sm font-medium text-neutral-600 hover:text-neutral-900 transition-colors dark:text-neutral-300 dark:hover:text-white">
        {t({ en: "About" })}
      </a>
    </div>
  </div>
</header>

<script>
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });
</script>

<script>
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });
</script>
