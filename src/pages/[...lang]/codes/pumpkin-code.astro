---
import { DEFAULT_LOCALE_SETTING, LOCALES_SETTING } from "@/locales";
import { useTranslations, type Lang } from "@/i18n";
import Layout from "@/layouts/BaseLayout.astro";
import CodeBlock from "@/components/CodeBlock.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import { images } from "@/lib/images";
import { Image } from "astro:assets";

const t = useTranslations(Astro.currentLocale as Lang);
const locale = Astro.currentLocale || DEFAULT_LOCALE_SETTING;

export const getStaticPaths = async () => {
    const paths = Object.keys(LOCALES_SETTING).map((lang) => {
        if (lang !== DEFAULT_LOCALE_SETTING) {
            return { params: { lang: lang } };
        } else {
            return { params: { lang: undefined } };
        }
    });
    return paths;
};

const title = {
    en: "Pumpkin Mega-Harvest Algorithm - The Farmer Was Replaced",
    zh: "å—ç“œå·¨å¤§åŒ–è‡ªåŠ¨åŒ–ç®—æ³•è¯¦è§£ - ç¼–ç¨‹å†œåœº",
    de: "KÃ¼rbis-Mega-Ernte-Algorithmus - The Farmer Was Replaced",
};

const description = {
    en: "Learn how to automate giant pumpkin farming. This script handles replanting, coordinate tracking, and mega-crop optimization.",
    zh: "å­¦ä¹ å¦‚ä½•è‡ªåŠ¨åŒ–ç§æ¤å·¨å¤§å—ç“œã€‚æœ¬è„šæœ¬åŒ…å«è¡¥ç§é€»è¾‘ã€åæ ‡è¿½è¸ªä»¥åŠå·¨å¤§åŒ–ä½œç‰©ä¼˜åŒ–ç­–ç•¥ã€‚",
    de: "Lernen Sie, wie man den Anbau von RiesenkÃ¼rbissen automatisiert. Dieses Skript behandelt das Nachpflanzen und die Optimierung.",
};
---

<Layout title={title} description={description}>
    <div class="max-w-4xl mx-auto px-4">
        
        <section class="py-10 text-center border-b border-gray-200 dark:border-gray-700">
            <h1 class="text-3xl md:text-4xl font-extrabold mb-6 text-gray-900 dark:text-white">
                {t({
                    en: "Mastering Mega Pumpkins: Coordinate Tracking",
                    zh: "ç²¾é€šå·¨å¤§å—ç“œï¼šåæ ‡è¿½è¸ªæ³•",
                    de: "Meisterung der RiesenkÃ¼rbisse: Koordinatenverfolgung"
                })}
            </h1>
            <p class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
                {t({
                    en: "Pumpkins are special because they fuse into larger crops. A simple harvest loop won't work. We need a smart script that waits for the fusion to complete.",
                    zh: "å—ç“œéå¸¸ç‰¹æ®Šï¼Œå› ä¸ºå®ƒä»¬ä¼šèšåˆæˆæ›´å¤§çš„ä½œç‰©ã€‚ç®€å•çš„å¾ªç¯æ”¶å‰²ä¸ä»…æ•ˆç‡ä½ï¼Œè¿˜ä¼šç ´åèšåˆã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ™ºèƒ½è„šæœ¬æ¥ç­‰å¾…èšåˆå®Œæˆã€‚",
                    de: "KÃ¼rbisse sind besonders, weil sie zu grÃ¶ÃŸeren Pflanzen verschmelzen. Wir brauchen ein intelligentes Skript."
                })}
            </p>
        </section>

        <section class="py-10 grid md:grid-cols-2 gap-8 items-center">
            <div class="order-2 md:order-1">
                <h2 class="text-2xl font-bold mb-4 text-orange-600 dark:text-orange-400">
                    {t({
                        en: "The Strategy: Patch & Wait",
                        zh: "æ ¸å¿ƒç­–ç•¥ï¼šä¿®è¡¥ä¸ç­‰å¾…",
                        de: "Die Strategie: Flicken & Warten"
                    })}
                </h2>
                <div class="prose dark:prose-invert text-gray-700 dark:text-gray-300 space-y-4">
                    <p>
                        {t({
                            en: "The goal is to get a full grid of pumpkins to form a Giant Pumpkin. If one spot dies or is empty, the fusion fails.",
                            zh: "æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©æ•´ä¸ªç½‘æ ¼é•¿æ»¡å—ç“œï¼Œä»è€Œå½¢æˆâ€œå·¨å¤§å—ç“œâ€ã€‚å¦‚æœç½‘æ ¼ä¸­å“ªæ€•æœ‰ä¸€ä¸ªä½ç½®æ˜¯ç©ºçš„æˆ–ä½œç‰©æ¯æ­»ï¼Œèšåˆå°±ä¼šå¤±è´¥ã€‚",
                            de: "Das Ziel ist es, ein volles Raster von KÃ¼rbissen zu bekommen, um einen RiesenkÃ¼rbis zu bilden."
                        })}
                    </p>
                    <ul class="list-disc pl-5 space-y-2">
                        <li>
                            <strong>{t({ zh: "è¿½è¸ª (Track):", en: "Track:", de: "Verfolgen:" })}</strong> 
                            {t({ zh: "è®°å½•æ‰€æœ‰å°šæœªæˆç†Ÿæˆ–ç©ºçš„åæ ‡ç‚¹ã€‚", en: "Record coordinates of all empty or unripe spots.", de: "Koordinaten aufzeichnen." })}
                        </li>
                        <li>
                            <strong>{t({ zh: "ä¿®è¡¥ (Patch):", en: "Patch:", de: "Flicken:" })}</strong> 
                            {t({ zh: "æ— äººæœºåªé£å‘è¿™äº›ç‰¹å®šåæ ‡è¿›è¡Œè¡¥ç§ï¼Œè€Œä¸æ˜¯ç›²ç›®éå†å…¨å›¾ã€‚", en: "Drone visits only these specific spots to replant.", de: "Drohne besucht nur diese Punkte." })}
                        </li>
                        <li>
                            <strong>{t({ zh: "æ”¶å‰² (Harvest):", en: "Harvest:", de: "Ernten:" })}</strong> 
                            {t({ zh: "åªæœ‰å½“åˆ—è¡¨ä¸­æ²¡æœ‰â€œé—®é¢˜åæ ‡â€æ—¶ï¼ˆæ„å‘³ç€å…¨å›¾å·²èšåˆï¼‰ï¼Œæ‰è¿›è¡Œæ”¶å‰²ã€‚", en: "Harvest only when the problem list is empty (grid is full).", de: "Ernten nur wenn das Raster voll ist." })}
                        </li>
                    </ul>
                </div>
            </div>
            <div class="order-1 md:order-2">
                <div class="bg-orange-50 dark:bg-orange-900/20 p-2 rounded-2xl shadow-lg border border-orange-100 dark:border-orange-800">
                     <div class="aspect-video flex items-center justify-center text-6xl">
                        ğŸƒ
                     </div>
                </div>
            </div>
        </section>

        <section class="py-10">
            <h2 class="text-2xl font-bold mb-8 text-center">
                {t({
                    en: "Step-by-Step Code Analysis",
                    zh: "ä»£ç åˆ†æ­¥è§£æ",
                    de: "Schritt-fÃ¼r-Schritt Code-Analyse"
                })}
            </h2>

            <div class="mb-12 bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700">
                <h3 class="text-xl font-bold mb-3 flex items-center gap-2">
                    <span class="bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300">Step 1</span>
                    {t({ zh: "æ™ºèƒ½ç§»åŠ¨é€»è¾‘", en: "Smart Movement Logic", de: "Intelligente Bewegung" })}
                </h3>
                <p class="mb-4 text-gray-600 dark:text-gray-400">
                    {t({
                        zh: "ä¸ºäº†é˜²æ­¢æ— äººæœºè¢«å·¨å¤§çš„å—ç“œå¡ä½ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´å¥å£®çš„ç§»åŠ¨å‡½æ•° `moveEx`ã€‚å¦‚æœä¸»è¦æ–¹å‘è¢«é˜»æŒ¡ï¼Œå®ƒä¼šå°è¯•å…¶ä»–æ–¹å‘ã€‚",
                        en: "To prevent the drone from getting stuck on giant pumpkins, we need a robust `moveEx` function. If blocked, it tries other directions.",
                        de: "Um zu verhindern, dass die Drohne stecken bleibt, benÃ¶tigen wir `moveEx`."
                    })}
                </p>
                <CodeBlock code={`def moveEx(dir):
    dirs=[East,South,West,North]
    dirs.remove(dir)
    # Try intended direction first
    if(not move(dir)):
        # If blocked, try alternatives to wiggle out
        if(not move(dirs[0])):
            if(not move(dirs[1])):
                if(not move(dirs[2])):
                    return False`} />
            </div>

            <div class="mb-12 bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700">
                <h3 class="text-xl font-bold mb-3 flex items-center gap-2">
                    <span class="bg-orange-100 text-orange-800 text-sm font-medium px-2.5 py-0.5 rounded dark:bg-orange-900 dark:text-orange-300">Step 2</span>
                    {t({ zh: "åæ ‡è¿½è¸ªä¸è¡¥ç§", en: "Tracking & Replanting", de: "Verfolgen & Nachpflanzen" })}
                </h3>
                <p class="mb-4 text-gray-600 dark:text-gray-400">
                    {t({
                        zh: "å‡½æ•° `doPumpkin` ç»´æŠ¤ä¸€ä¸ª `success` åˆ—è¡¨ã€‚å®ƒä¼šåå¤æ£€æŸ¥è¿™ä¸ªåˆ—è¡¨ä¸­çš„ä½ç½®ï¼Œç›´åˆ°æ‰€æœ‰ä½ç½®éƒ½æ»¡è¶³æ”¶è·æ¡ä»¶ï¼ˆå³å…¨éƒ¨é•¿å¥½ï¼‰ã€‚",
                        en: "The `doPumpkin` function maintains a \`success\` list. It repeatedly checks spots in this list until everything is ready.",
                        de: "Die Funktion `doPumpkin` verwaltet eine Liste."
                    })}
                </p>
                <CodeBlock code={`def doPumpkin():
    back()
    success = [] # List of "problematic" coordinates
    
    # Helper to track empty spots
    def adddie():
        if not can_harvest():
            success.append({"x":get_pos_x(),"y":get_pos_y()})
            plantpumpkin()

    # Helper to check if spot is fixed
    def removedie():
        if(can_harvest()):
            success.remove({"x":get_pos_x(),"y":get_pos_y()})
        else:
            plantpumpkin()

    # Initial Pass: Scan whole grid
    plantonce(adddie) 
    
    # Re-visit Loop: Only go to bad spots
    while(len(success) != 0):
        for pos in success:
            back(pos["x"],pos["y"])
            removedie()

    return len(success)==0`} />
            </div>
        </section>

        <section class="mb-16">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold">
                    {t({
                        en: "Complete Source Code",
                        zh: "å®Œæ•´æºä»£ç ",
                        de: "VollstÃ¤ndiger Quellcode"
                    })}
                </h2>
                <span class="text-sm text-gray-500 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full">
                    Python
                </span>
            </div>
            
            <p class="mb-4 text-sm text-gray-500 italic">
                {t({
                    zh: "æ³¨ï¼šæ­¤ä»£ç åŒ…å«å¤šç§ä½œç‰©çš„é€»è¾‘ï¼Œä½†ä¸»è¦å…¥å£ç‚¹æ˜¯åº•éƒ¨çš„ pumpProject()ã€‚",
                    en: "Note: This script includes logic for multiple crops, but the main entry point is pumpProject() at the bottom.",
                    de: "Hinweis: Dieses Skript enthÃ¤lt Logik fÃ¼r mehrere Pflanzen."
                })}
            </p>

            <div class="relative group">
                <div class="absolute -inset-1 bg-gradient-to-r from-orange-600 to-yellow-600 rounded-lg blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
                <div class="relative">
                    <CodeBlock
                        height="max-h-[800px]"
                        code={`def back(x=0,y=0):
    while x!=get_pos_x() or y!=get_pos_y():
        while get_pos_x()!=x:
            if(get_pos_x()<x):
                moveEx(East)
            else:
                moveEx(West)
        while get_pos_y()!=y:
            if(get_pos_y()<y):
                moveEx(North)
            else:
                moveEx(South)

def moveEx(dir):
    dirs=[East,South,West,North]
    dirs.remove(dir)
    if(not move(dir)):
        if(not move(dirs[0])):
            if(not move(dirs[1])):
                if(not move(dirs[2])):
                    return False
    
def do(x,worldsize=0):
    if worldsize == 0:
        worldsize=get_world_size()
    dir=East
    for i in range(worldsize):
        for j in range(worldsize-1):
            x()
            move(dir)
        x()
        move(North)
        if(dir==East):
            dir=West
        else:
            dir=East

# --- Pumpkin Logic Start ---
def plantpumpkin():
    plant(Entities.Pumpkin) 

def doPumpkin():
    back()
    success = []
    def adddie():
        if not can_harvest():
            success.append({"x":get_pos_x(),"y":get_pos_y()})
            plantpumpkin()

    def removedie():
        if(can_harvest()):
            success.remove({"x":get_pos_x(),"y":get_pos_y()})
        else:
            plantpumpkin()

    def plantonce(x):
        dir = East
        for i in range(get_world_size()):
            for j in range(get_world_size()-1):
                x()
                move(dir)
            x()
            move(North)
            if dir == East:
                dir=West
            else:
                dir=East
    
    plantonce(plantpumpkin) # First planting
    back()
    plantonce(adddie) # Check for failures
    
    # Keep fixing specific spots
    while(len(success) != 0):
        for pos in success:
            back(pos["x"],pos["y"])
            removedie()

    return len(success)==0

def pumpProject():
    # Helper to till ground first
    def tillx():
        if(get_ground_type()==Grounds.Grassland):
            till()
    back()
    do(tillx)
    
    while True:
        # Wait until doPumpkin returns true (all spots ready)
        while doPumpkin():
            back()
            harvest()
# --- Pumpkin Logic End ---

# Start the bot
clear()
pumpProject()`}
                    />
                </div>
            </div>
        </section>

        <section class="py-8 bg-orange-50 dark:bg-orange-900/20 rounded-2xl border border-orange-100 dark:border-orange-800 p-6 mb-12">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2 text-orange-800 dark:text-orange-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                {t({ zh: "å—ç“œç§æ¤æŠ€å·§", en: "Pumpkin Farming Tips", de: "KÃ¼rbis-Anbautipps" })}
            </h3>
            <ul class="space-y-2 text-orange-900 dark:text-orange-100">
                <li class="flex items-start gap-2">
                    <span class="font-bold">â€¢</span>
                    {t({
                        zh: "ç¡®ä¿ä½ çš„åœŸåœ°å·²ç»å¼€å¦ã€‚è¯¥è„šæœ¬åŒ…å« `tillx` å‡½æ•°ä¼šè‡ªåŠ¨å¼€å¦è‰åœ°ã€‚",
                        en: "Ensure your land is tilled. The script includes `tillx` to handle grassland automatically.",
                        de: "Stellen Sie sicher, dass Ihr Land gepflÃ¼gt ist."
                    })}
                </li>
                <li class="flex items-start gap-2">
                    <span class="font-bold">â€¢</span>
                    {t({
                        zh: "å°½é‡ä½¿ç”¨æµ‡æ°´ç³»ç»Ÿã€‚è™½ç„¶è„šæœ¬èƒ½å·¥ä½œï¼Œä½†æœ‰æ°´çš„æƒ…å†µä¸‹å—ç“œé•¿å¾—æ›´å¿«ï¼Œå·¨å¤§åŒ–çš„å‡ ç‡æ›´é«˜ã€‚",
                        en: "Use water if possible. Pumpkins grow faster and fuse more reliably on watered soil.",
                        de: "Verwenden Sie wenn mÃ¶glich Wasser."
                    })}
                </li>
            </ul>
        </section>

        <section class="py-8 border-t border-neutral-200 dark:border-neutral-700">
            <div class="flex justify-center">
                <a href={getRelativeLocaleUrl(locale, "/")} class="inline-flex items-center gap-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 rounded-full transition text-gray-700 dark:text-gray-300 font-medium">
                    <span>â†</span>
                    {t({
                        en: "Back to Home",
                        zh: "è¿”å›ä¸»é¡µ",
                        de: "ZurÃ¼ck zur Startseite"
                    })}
                </a>
            </div>
        </section>
        
        <div id="utterances-container" class="my-10"></div>
    </div>
</Layout>